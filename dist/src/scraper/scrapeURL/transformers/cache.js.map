{"version":3,"file":"cache.js","sourceRoot":"","sources":["../../../../../src/scraper/scrapeURL/transformers/cache.ts"],"names":[],"mappings":";;;AAEA,8CAA4E;AAE5E,SAAgB,WAAW,CAAC,IAAU,EAAE,QAAkB;IACtD,IAAI,QAAQ,CAAC,QAAQ,CAAC,UAAW,GAAG,GAAG,IAAI,QAAQ,CAAC,QAAQ,CAAC,UAAW,IAAI,GAAG;QAAE,OAAO,QAAQ,CAAC;IAEjG,IAAI,QAAQ,CAAC,OAAO,KAAK,SAAS,EAAE,CAAC;QACjC,MAAM,IAAI,KAAK,CAAC,uEAAuE,CAAC,CAAC;IAC7F,CAAC;IAED,MAAM,GAAG,GAAG,IAAA,gBAAQ,EAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IAEnE,IAAI,GAAG,KAAK,IAAI,EAAE,CAAC;QACf,MAAM,KAAK,GAAe;YACtB,IAAI,EAAE,QAAQ,CAAC,OAAQ;YACvB,UAAU,EAAE,QAAQ,CAAC,QAAQ,CAAC,UAAW;YACzC,GAAG,EAAE,QAAQ,CAAC,QAAQ,CAAC,GAAG,IAAI,QAAQ,CAAC,QAAQ,CAAC,SAAU;YAC1D,KAAK,EAAE,QAAQ,CAAC,QAAQ,CAAC,KAAK,IAAI,SAAS;SAC9C,CAAC;QAEF,IAAA,wBAAgB,EAAC,GAAG,EAAE,KAAK,CAAC,CAAC;IACjC,CAAC;IAED,OAAO,QAAQ,CAAC;AACpB,CAAC;AArBD,kCAqBC","sourcesContent":["import { Document } from \"../../../controllers/v1/types\";\nimport { Meta } from \"..\";\nimport { CacheEntry, cacheKey, saveEntryToCache } from \"../../../lib/cache\";\n\nexport function saveToCache(meta: Meta, document: Document): Document {\n    if (document.metadata.statusCode! < 200 || document.metadata.statusCode! >= 300) return document;\n\n    if (document.rawHtml === undefined) {\n        throw new Error(\"rawHtml is undefined -- this transformer is being called out of order\");\n    }\n\n    const key = cacheKey(meta.url, meta.options, meta.internalOptions);\n\n    if (key !== null) {\n        const entry: CacheEntry = {\n            html: document.rawHtml!,\n            statusCode: document.metadata.statusCode!,\n            url: document.metadata.url ?? document.metadata.sourceURL!,\n            error: document.metadata.error ?? undefined,\n        };\n\n        saveEntryToCache(key, entry);\n    }\n\n    return document;\n}"]}